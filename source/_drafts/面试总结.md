---
title: 2019
tags: [java]
date: 2019-02-20 20:00:00
---

> 面试总结

#### 一个百万级的数据表，根据一个字段更新另一个值，使用乐观锁实现

面试的时候不记得数据库乐观锁的实现。。。我说了下代码的CAS的思想。但是，面试官反问，那乐观锁就是没有锁了。问懵逼了。。。回来看了下数据库乐观锁的实现。感觉就是 CAS 的思想呀，就是没锁。。。（不对请指正）

商品减库存的例子
```
# 查询出商品的信息
select count,version from goods where id =#{id}
# 执行减库存
update goods set count = count - 2 and count > 0 where id = #{id} and version = #{version}
```
#### 手写 string.indexof

```
  /**
     * 返回  s2 在 s1 中首次出现的位置
     * <p>
     * 逻辑：
     * 1、找到第一个字符匹配
     * 2、然后依次向后比较
     * 3、如果累计比较的次数 == s2 的大小,则返回第一次匹配的位置
     *
     * @param s1
     * @param s2
     * @return
     */
    public static int indexOf(String s1, String s2) {
        int sourceSize = s1.length();
        int targetSize = s2.length();

        if (sourceSize < targetSize) {
            return -1;
        }

        char[] source = s1.toCharArray();
        char[] target = s2.toCharArray();

        char first = target[0];
        int max = sourceSize - targetSize;

        for (int i = 0; i <= max; i++) {
            //Look for first character
            if (first != source[i]) {
                while (++i <= max && source[i] != first) ;
            }

            /* Found first character, now look at the rest of s2 */
            if (i <= max) {
                int j = i + 1;
                int end = i + targetSize;
                for (int k = 1; j < end && source[j] == target[k]; j++, k++) ;

                if (j == end) {
                    /* Found whole string. */
                    return i;
                }
            }
        }
        return -1;
    }
```
#### 如何快速判断两个集合相等

#### 时间复杂度的概念

O(1) O(n)