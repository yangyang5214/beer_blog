---
title: 求上下20%
date: 2019-04-10 00:01:16
tags: java
---


> 怎么描述呢？实际业务中，要根据一个字段返回这个公司相近的公司集合。(这个字段暂且定为总收入吧)。也就是说找一个公司总收入相近的 上下20%的公司。


```
eg: A 公司总收入：100
则查找的公司为收入在 80 ~ 120 之间的公司。并且取相近的10个。
```

### 比如数据集合是下图：（已经是 20% 区间的数了）

其实就是找 list 集合一个元素（假设：company_id = 2）相近的几个元素的值。
那就是找 income 的值距离 0.096最近的几个值对应的 company_id。


![](https://beer-1256523277.cos.ap-shanghai.myqcloud.com/beer/blog/20190410.png
)


之前的想法是：找个该公司，按照 income 的值排序，然后开始上下取值，直到取够 maxSize(即你要去的个数)。但是，这个公司前后的数据不是那么平均。比如：可能是数据集合为 ：1，2，3，5，22，44，555。假设现在的公司的 income 为 5 ，那我取相近的则一直是往前取的。不好操作。


----

后面想到绝对值。然后排序（absList）。map 维持关系（绝对值 and company_id）。

```
    @Test
    public void test(){
        //要取的数量
        int maxSize = 10;
        //结果集
        List<String> result = new ArrayList<>();
        //造数据。（实际从数据库查找）
        List<JSONObject> list = buildData();

        //companyId 为 2 的公司，找相近的公司集合。
        String companyId = "2";
        double income = 0.2;

        HashMap<Double,String> map = new HashMap();
        List<Double> absList = new ArrayList();
        for (JSONObject jsonObject : list) {
            if (companyId != jsonObject.get("company_id")){
                double abs = Math.abs(jsonObject.getDouble("income") - income);
                map.put(abs,jsonObject.getString("company_id"));
                absList.add(abs);
            }
        }
        absList.sort(Double::compareTo);

        maxSize = absList.size() > maxSize ? maxSize : absList.size();

        for (int i = 0; i <maxSize ; i++) {
            result.add(map.get(absList.get(i)));
        }
        System.out.println(result);
    }

    public List<JSONObject> buildData(){
        List<JSONObject> list = new ArrayList<>();
        for (int i = 0; i < 100; i++) {
            JSONObject jsonObject = new JSONObject();
            jsonObject.put("company_id",i);
            jsonObject.put("income", Math.random());
            list.add(jsonObject);
        }
        return list;
    }
```
----

但是，有个问题是：如果绝对值相同的，可能丢失 company_id。（因为 map key 替换的原因）

```
//核心代码
for (JSONObject jsonObject : list) {
            if (companyId != jsonObject.get("company_id")){

                double abs = Math.abs(jsonObject.getDouble("income") - income);

                //容错性(防止绝对值相同的，company_id 丢失)
                if(map.containsKey(abs)){
                    abs = abs + 0.00001;
                }
                map.put(abs,jsonObject.getString("company_id"));
                absList.add(abs);
            }
        }
```


一点了，睡觉觉 💤！！！